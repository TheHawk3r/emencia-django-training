
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Logging : Rappel &#8212; Documentation Formation Django 1.0</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />

  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />


  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            <div class="section" id="sommaire">
              <a href="/emencia-django-training/src/home.html" class="button">SOMMAIRE</a>
            </div>

  <div class="section" id="logging-rappel">
<span id="logging-rappel"></span><h1>Logging : Rappel<a class="headerlink" href="#logging-rappel" title="Lien permanent vers ce titre">¶</a></h1>
<p>Django utilise le module <code class="docutils literal notranslate"><span class="pre">logging</span></code> fournit par Python. Pour se renseigner sur le logging, on peut donc commencer par faire un petit tour sur <a class="reference external" href="https://docs.python.org/2/library/logging.html">la documentation du module logging</a></p>
<p>Il y a 4 parties distinctes :</p>
<ul class="simple">
<li>Loggers : permet d’écrire des messages à partir d’un niveau donné de log. (DEBUG, INFO, WARNING, ERROR, CRITICAL)</li>
<li>Handlers : définie le comportement des logs (écriture en console, dans un fichier, etc…). Possède également un niveau de log. Plusieurs handlers peuvent être associés à un logger.</li>
<li>Filters : permet d’ajouter des critères pour filtrer les logs à prendre en compte. Peut également permettre de modifier des logs avant écriture. Les filtres peuvent être chainés.</li>
<li>Formatters : permet d’écrire (enfin) le log en tant que texte sous un format particulier.</li>
</ul>
<p>Pour faire fonctionner correctement le logging, il faut donc configurer ces 4 parties. Ensuite, nous pouvons enregistrer des logs.</p>
<p>Exemple :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Something not quite right!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">logging.getLogger()</span></code> renvoie un logger qui est identifié par un nom utilisé pour la configuration.
Par convention, on utilise généralement <code class="docutils literal notranslate"><span class="pre">__name__</span></code> (nom du module python qui contient le logger). Cela permet de filtrer les logs par module.</p>
<p>Un  logger possède différentes méthodes qui correspondent aux différents niveaux de log possible :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">logger.debug()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">logger.info()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">logger.warning()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">logger.error()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">logger.critical()</span></code></li>
</ul>
<p>Il existe deux autres méthodes qui peuvent d’avérer utiles :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">logger.log()</span></code> permet d’émettre manuellement un log avec un niveau particulier</li>
<li><code class="docutils literal notranslate"><span class="pre">logger.exception()</span></code> permet de créer un log de niveau «&nbsp;ERROR&nbsp;» qui englobe le message de d’erreur.</li>
</ul>
</div>
<div class="section" id="configuration-en-django">
<span id="configuration-en-django"></span><h1>Configuration en Django<a class="headerlink" href="#configuration-en-django" title="Lien permanent vers ce titre">¶</a></h1>
<p>Il existe plusieurs façons de configurer le logging, Django utilise le format <code class="docutils literal notranslate"><span class="pre">dictConfig</span></code> via le paramètre <code class="docutils literal notranslate"><span class="pre">settings.LOGGING</span></code>. Ainsi, nous pouvons définir les 4 parties du logging en un endroit.</p>
<p>Par défaut, ce paramètre est fusionné avec la configuration par défaut de Django. Pour plus de détail sur la configuration du logging en Django, se référer à <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/logging/">la documentation officielle</a>.</p>
<p>Voici un exemple complet d’une configuration de logging (tiré de la documentation officielle)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s1">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(asctime)s</span><span class="s1"> </span><span class="si">%(module)s</span><span class="s1"> </span><span class="si">%(process)d</span><span class="s1"> </span><span class="si">%(thread)d</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;simple&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">%(levelname)s</span><span class="s1"> </span><span class="si">%(message)s</span><span class="s1">&#39;</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;special&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;()&#39;</span><span class="p">:</span> <span class="s1">&#39;project.logging.SpecialFilter&#39;</span><span class="p">,</span>
            <span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;require_debug_true&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;()&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.RequireDebugTrue&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;console&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;require_debug_true&#39;</span><span class="p">],</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;logging.StreamHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;formatter&#39;</span><span class="p">:</span> <span class="s1">&#39;simple&#39;</span>
        <span class="p">},</span>
        <span class="s1">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;django.utils.log.AdminEmailHandler&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;django&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">],</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mail_admins&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s1">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;myproject.custom&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;console&#39;</span><span class="p">,</span> <span class="s1">&#39;mail_admins&#39;</span><span class="p">],</span>
            <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
            <span class="s1">&#39;filters&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;special&#39;</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Le code ci-dessus définit un numéro de version, deux formatters, deux filters, deux handlers (un pour le débug/développement et un plus proche d’un comportement de production), et trois loggers.</p>
<p>Il est également possible d’utiliser des configurations plus personnelles pour le <code class="docutils literal notranslate"><span class="pre">LOGGING</span></code> (cf documentation officielle pour des utilisations plus fines).</p>
<p>Django fournit quelques loggers de base :</p>
<ul class="simple">
<li>«&nbsp;django&nbsp;» est un logger qui attrape tous les messages.</li>
<li>«&nbsp;django.request&nbsp;» enregistre les logs relatifs aux requêtes. Les réponses avec un statut 5xx seront des messages de niveau «&nbsp;ERROR&nbsp;», 4XX de niveau «&nbsp;WARNING&nbsp;», le reste de niveau «&nbsp;INFO&nbsp;». Ce logger reçoit un contexte supplémentaire : <code class="docutils literal notranslate"><span class="pre">status_code</span></code> et <code class="docutils literal notranslate"><span class="pre">request</span></code>.</li>
<li>«&nbsp;django.db.backends&nbsp;» enregistre les messages relatifs aux interactions avec la base de données. Contexte : <code class="docutils literal notranslate"><span class="pre">duration</span></code>, <code class="docutils literal notranslate"><span class="pre">sql</span></code> (la requête sql), <code class="docutils literal notranslate"><span class="pre">params</span></code>. Pour des raisons de performance, ce logger est seulement activé lorsque : <code class="docutils literal notranslate"><span class="pre">DEBUG=True</span></code></li>
<li>«&nbsp;django.security&nbsp;» enregistre les messages liés à la sécurité</li>
</ul>
<p>Django fournit un handler qui permet d’envoyer les logs de niveaux «&nbsp;ERROR&nbsp;» et «&nbsp;CRITICAL&nbsp;» aux administrateurs définis dans le fichier de settings par email.</p>
<p>Django offre trois filters :</p>
<ul class="simple">
<li>CallbackFilter(callback) qui permet de fournir un callback à appeler pour chaque log pour déterminer si le log doit être conserver ou non.</li>
<li>RequireDebugFalse qui ne gardera les logs que si <code class="docutils literal notranslate"><span class="pre">settings.DEBUG=False</span></code> et <code class="docutils literal notranslate"><span class="pre">RequireDebugTrue</span></code> qui fait donc l’inverse.</li>
</ul>
</div>
<div class="section" id="configuration-par-defaut">
<span id="configuration-par-defaut"></span><h1>Configuration par défaut<a class="headerlink" href="#configuration-par-defaut" title="Lien permanent vers ce titre">¶</a></h1>
<p>Avec <code class="docutils literal notranslate"><span class="pre">DEBUG=True</span></code> :</p>
<p>Le logger «&nbsp;catch-all&nbsp;» envoie tous les logs à partir du niveau «&nbsp;INFO&nbsp;» vers la console.</p>
<p>Avec <code class="docutils literal notranslate"><span class="pre">DEBUG=False</span></code> :</p>
<p>Les logs à partir du niveau «&nbsp;ERROR&nbsp;» sont envoyés vers <code class="docutils literal notranslate"><span class="pre">AdminEmailHandler</span></code>.</p>
<p>Dans tous les cas :</p>
<p>Le logger <code class="docutils literal notranslate"><span class="pre">django.server</span></code> envoie tous les logs à partir du niveau «&nbsp;INFO&nbsp;» vers la console.</p>
</div>
<div class="section" id="footer">
  <a href="/emencia-django-training/src/detection-langage-utilisateur-et-urls.html" class="button left">PRÉCEDENT</a>
  <a href="/emencia-django-training/src/deploiement.html" class="button right">SUIVANT</a>
</div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table des Matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Logging : Rappel</a></li>
<li><a class="reference internal" href="#configuration-en-django">Configuration en Django</a></li>
<li><a class="reference internal" href="#configuration-par-defaut">Configuration par défaut</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/src/Logging.md.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Adrien Brunet.

      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>

      |
      <a href="../_sources/src/Logging.md.txt"
          rel="nofollow">Page source</a>
    </div>




  </body>
</html>
