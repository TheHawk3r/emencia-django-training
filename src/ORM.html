
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Object-Relational Mapping &#8212; Documentation Formation Django 1.0</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />

  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />


  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            <div class="section" id="sommaire">
              <a href="/emencia-django-training/src/home.html" class="button">SOMMAIRE</a>
            </div>

  <div class="section" id="object-relational-mapping">
<span id="object-relational-mapping"></span><h1>Object-Relational Mapping<a class="headerlink" href="#object-relational-mapping" title="Lien permanent vers ce titre">¶</a></h1>
<p>Object-relational mapping (ORM) est une technique en programmation objet pour convertir des données entre deux systèmes incompatibles entre eux. Cela crée un «&nbsp;objet virtuel de base de donnée&nbsp;» qui peut être utilisé au sein du langage de programmation.</p>
<div class="section" id="django-orm">
<span id="django-orm"></span><h2>Django ORM<a class="headerlink" href="#django-orm" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="justification">
<span id="justification"></span><h3>Justification<a class="headerlink" href="#justification" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’ORM de Django permet ici de représenter à travers des objets (python) des tables en base de données.</p>
<p>Ainsi nous avons la possibilité de créer des requêtes SQL sans jamais écrire réellement de SQL. On ne fait que manipuler des objets python. Nous pouvons filtrer les éléments, les ordonner, les créer/supprimer etc… Sans trop se soucier de faire des définitions des tables, des jointures, de la mise en place des indexes et autre joyeusetés…</p>
</div>
<div class="section" id="migrations">
<span id="migrations"></span><h3>Migrations<a class="headerlink" href="#migrations" title="Lien permanent vers ce titre">¶</a></h3>
<p>Par le biais de cet ORM, lorsque les tables sont modifiées (ajout d’un champ par exemple), Django peut générer des migrations (en python) qui se chargeront de mettre à jour les bases de données avec le schéma correspondant mis à jour. Ces migrations pourront être appliquées sur l’ensemble des bases, aussi bien localement, que sur les serveurs de développement ou de production.</p>
<p>Par ailleurs, ces migrations peuvent également être jouées «&nbsp;à l’envers&nbsp;» pour revenir dans un état antérieur. Cet outil est extrêmement puissant et assure la concordance entre les modèles définis en python et leur représentation effective en base de données.</p>
<p>Example minimal avec deux modèles et quelques requêtes:</p>
<p><em>my_app/models.py</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">Models</span>


<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>


<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Bar with Foo model &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foo</span><span class="p">)</span>
</pre></div>
</div>
<p>En exécutant la commande Django suivante:</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">makemigrations</span> <span class="pre">my_app</span></code></p>
<p>Django va créer un fichier de migration dans <code class="docutils literal notranslate"><span class="pre">my_app/migrations/</span></code>. Nous pouvons l’appliquer avec la commande suivante:</p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">migrate</span> <span class="pre">my_app</span></code></p>
<p>Après cette exécution, notre base de données aura deux nouvelles tables disponibles.</p>
<p>Quand nous avons maintenant besoin de manipuler ces objets, nous pouvons facilement le faire par le biais de ces modèles sans écrire de SQL pour les récupérer depuis la base de données :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">my_app.models</span> <span class="kn">import</span> <span class="n">Bar</span><span class="p">,</span> <span class="n">Foo</span>

<span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">bar</span> <span class="o">=</span> <span class="n">Bar</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="n">foo1</span><span class="p">)</span>

<span class="n">fooz</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__icontains</span><span class="o">=</span><span class="s2">&quot;test name&quot;</span><span class="p">)</span>

<span class="n">all_bars</span> <span class="o">=</span> <span class="n">Bar</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="n">no_foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">none</span><span class="p">()</span>

<span class="n">alpha_five_first_fooz</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>

<span class="n">Bar</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">foo__in</span><span class="o">=</span><span class="n">alpha_five_first_fooz</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>Ces migrations nous permettent de garder un historique de nos changements et sont valables pour différents types de base de données. On peut très bien les appliquer sur une base sqlite en local et sur une base Postgres sur le serveur de production.
Il faut cependant noter que dans des cas d’optimisations, il peut être intéressant d’écrire soit même la requête SQL et cela reste tout à fait possible de l’executer via Django. Cette approche est cependant hors du cadre de cette formation et ne sera probablement pas nécessaire pour des cas d’utilisation simples et classiques.</p>
</div>
</div>
</div>
<div class="section" id="footer">
  <a href="/emencia-django-training/src/modele-mvt.html" class="button left">PRÉCEDENT</a>
  <a href="/emencia-django-training/src/sites-utlisant-django.html" class="button right">SUIVANT</a>
</div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table des Matières</a></h3>
  <ul>
<li><a class="reference internal" href="#">Object-Relational Mapping</a><ul>
<li><a class="reference internal" href="#django-orm">Django ORM</a><ul>
<li><a class="reference internal" href="#justification">Justification</a></li>
<li><a class="reference internal" href="#migrations">Migrations</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/src/ORM.md.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Adrien Brunet.

      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>

      |
      <a href="../_sources/src/ORM.md.txt"
          rel="nofollow">Page source</a>
    </div>




  </body>
</html>
